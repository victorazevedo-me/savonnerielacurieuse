<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maintenance</title>
</head>
<body>

    <textarea id="text" style="height: 90vh; width: 90vw;"></textarea>

    <form method="post" action="./update.php" target="frame">
        <input type="hidden" name="data" id="hiddendata">
        <input type="hidden" name="username">
        <input type="password" autocomplete="current-password" name="psw" placeholder="mot de passe">
    </form>
    <iframe name="frame" style="display: none"></iframe>
    
    <button id="submit">Mettre Ã  jour</button>
    <script>

        function modify(json) {

            const toUnicode = str => str.replace(/(&amp;)/g, "&").replace(/(&gt;)/g, ">").replace(/(&lt;)/g, "<").replace(/(&quot;)/g, '"');

            const textarea = document.querySelector('#text');
            const button = document.querySelector('#submit');
            const hidden = document.querySelector('#hiddendata');
            const form = document.querySelector('form');

            textarea.value = toUnicode(json)

            button.onclick = function() {
                hidden.value = textarea.value
                form.submit()
            }
        }

        fetch("./database.json").then(resp => (
            resp.text().then(data => modify(data)))
        )
    </script>
</body>
</html>